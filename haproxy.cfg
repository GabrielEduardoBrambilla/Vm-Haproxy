global
    log stdout format raw local0

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

frontend https_front
    bind *:443 ssl crt /etc/haproxy/certs/haproxy.pem
    
    # ACLs
    acl is_api path_beg /chamadaqr/api
    acl is_auth path_beg /auth
    acl is_realms path_beg /realms
    
    # Routing
    use_backend backend_app if is_api
    use_backend keycloak_service if is_auth
    use_backend keycloak_service if is_realms
    
    # Default to backend for now (or 404)
    default_backend backend_app

backend backend_app
    # Pointing to the backend container. 
    # Assuming host networking or host.docker.internal for Windows Docker Desktop
    server backend1 host.docker.internal:8443 ssl verify none

backend keycloak_service
    # Pointing to the Keycloak server IP provided in previous context
    server keycloak1 192.168.56.104:443 ssl verify none

listen stats
    bind *:8404
    stats enable
    stats uri /monitor
    stats refresh 5s
